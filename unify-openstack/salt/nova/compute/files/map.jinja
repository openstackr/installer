{% set nova_compute =  salt['grains.filter_by']({
    'RedHat': {
        'my_ip': 'localhost',
        'vnc_enabled':'True',
        'vncserver_listen': '0.0.0.0',
        'vncserver_proxyclient_address': 'localhost',
        'novncproxy_base_url': 'controller',
        'glance_host': 'controller',
        'virt_type': 'kvm' 
    },
    'Debian': {
        'my_ip': 'localhost',
        'vnc_enabled':'True',
        'vncserver_listen': '0.0.0.0',
        'vncserver_proxyclient_address': 'localhost',
        'novncproxy_base_url': 'controller',
        'glance_host': 'controller',
        'virt_type': 'kvm'
      },
    }, merge=salt['pillar.get']('openstack-instance:' + pillar['current-openstack-instance'] + ':openstack-components:nova:compute')) %}



{% set nova_compute_service =  salt['grains.filter_by']({
    'RedHat': {
       'libvirt': 'libvirtd',
       'novacompute': 'openstack-nova-compute',
    },
    'Debian': {
         'libvirt': 'libvirtd',
         'novacompute': 'openstack-nova-compute',
    },
}, ) %}

{% set controller_ip = [] %}
  {%- for key, value in salt['mine.get']('G@openstack-id:' + grains['openstack-id'] + ' and G@function:controller','network.ip_addrs','compound').items() -%}
    {% do controller_ip.append(value) %}
  {%- endfor -%}

